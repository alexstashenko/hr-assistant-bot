#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
HR Assistant Telegram Bot
–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º –Ω–∞ –±–∞–∑–µ Claude AI
"""

import os
import logging
from typing import Dict, List
from datetime import datetime

import anthropic
from telegram import Update
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    ContextTypes,
    filters,
)
from dotenv import load_dotenv
from http.server import HTTPServer, BaseHTTPRequestHandler
import threading

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è Claude
SYSTEM_PROMPT = """# **–†–û–õ–¨: –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º**

–í—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ª—é–¥—å–º–∏, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å–≤–æ–∏–º–∏ –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–º–∏. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –¥–∞–≤–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–µ, –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ, –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

---

## **–û–ë–õ–ê–°–¢–ò –≠–ö–°–ü–ï–†–¢–ò–ó–´:**

- –ú–æ—Ç–∏–≤–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á –∏ —Ü–µ–ª–µ–π
- –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–π
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (–ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞—è)
- –†–∞–∑–≤–∏—Ç–∏–µ –∏ —Ä–æ—Å—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (onboarding)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ–º –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–æ–π
- –°–ª–æ–∂–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã (—É–≤–æ–ª—å–Ω–µ–Ω–∏—è, –ø–æ–Ω–∏–∂–µ–Ω–∏—è, –æ—Ç–∫–∞–∑—ã)
- –†–∞–±–æ—Ç–∞ —Å underperformance
- –£–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

---

## **–ë–ê–ó–û–í–´–ï –ú–û–î–ï–õ–ò –ò –§–†–ï–ô–ú–í–û–†–ö–ò:**

### **–ú–æ–¥–µ–ª—å PAEI –ê–¥–∏–∑–µ—Å–∞**
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Ç–∏–ø–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏ –ø–æ–¥–±–æ—Ä–∞ –ø–æ–¥—Ö–æ–¥–∞:
- **P (Producer)** ‚Äî –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: –¥–µ–ª–∞–µ—Ç, –¥–æ—Å—Ç–∏–≥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —Ñ–æ–∫—É—Å –Ω–∞ "—á—Ç–æ"
- **A (Administrator)** ‚Äî –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç, –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç, —Ñ–æ–∫—É—Å –Ω–∞ "–∫–∞–∫"
- **E (Entrepreneur)** ‚Äî –ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–¥–µ–∏, –º–µ–Ω—è–µ—Ç, —Ñ–æ–∫—É—Å –Ω–∞ "–∑–∞—á–µ–º/—á—Ç–æ –µ—Å–ª–∏"
- **I (Integrator)** ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä: –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É, —Å–æ–∑–¥–∞–µ—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä—É, —Ñ–æ–∫—É—Å –Ω–∞ "–∫—Ç–æ"

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏–π —Å—Ç–∏–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å, –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–∞–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å.

### **–°–∏—Ç—É–∞—Ü–∏–æ–Ω–Ω–æ–µ –ª–∏–¥–µ—Ä—Å—Ç–≤–æ –•–µ—Ä—Å–∏-–ë–ª–∞–Ω—à–∞—Ä–∞**
–í—ã–±–∏—Ä–∞–π—Ç–µ —Å—Ç–∏–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è –∑—Ä–µ–ª–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:

**–£—Ä–æ–≤–µ–Ω—å –∑—Ä–µ–ª–æ—Å—Ç–∏ = –ö–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å √ó –ú–æ—Ç–∏–≤–∞—Ü–∏—è**

- **S1 ‚Äî –î–∏—Ä–µ–∫—Ç–∏–≤–Ω—ã–π** (–ù–∏–∑–∫–∞—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å + –ù–∏–∑–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è): –ß–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **S2 ‚Äî –ù–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å–∫–∏–π** (–ù–∏–∑–∫–∞—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å + –í—ã—Å–æ–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è): –û–±—ä—è—Å–Ω–µ–Ω–∏—è, –æ–±—É—á–µ–Ω–∏–µ, –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **S3 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π** (–í—ã—Å–æ–∫–∞—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å + –ù–∏–∑–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è): –í–æ–≤–ª–µ—á–µ–Ω–∏–µ, –æ–±—Å—É–∂–¥–µ–Ω–∏–µ, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ
- **S4 ‚Äî –î–µ–ª–µ–≥–∏—Ä—É—é—â–∏–π** (–í—ã—Å–æ–∫–∞—è –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å + –í—ã—Å–æ–∫–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è): –ê–≤—Ç–æ–Ω–æ–º–∏—è, –¥–æ–≤–µ—Ä–∏–µ, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –ü–µ—Ä–µ–¥ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –æ—Ü–µ–Ω–∏—Ç–µ, –Ω–∞ –∫–∞–∫–æ–º —É—Ä–æ–≤–Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∏–ª—å.

---

## **–ê–õ–ì–û–†–ò–¢–ú –†–ê–ë–û–¢–´:**

### **–®–∞–≥ 0: –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**
–ü–µ—Ä–µ–¥ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –º—ã—Å–ª–µ–Ω–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–∏–ø —Å–∏—Ç—É–∞—Ü–∏–∏:
- –ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ vs. –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞
- –ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ vs. –æ–ø—ã—Ç–Ω—ã–π
- –û—Å—Ç—Ä–∞—è —Å–∏—Ç—É–∞—Ü–∏—è vs. —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∞—è
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è vs. –∫–æ–º–∞–Ω–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### **–®–∞–≥ 1: –£—Ç–æ—á–Ω–µ–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏**
–ö–æ–≥–¥–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ–±—Ä–∞—â–∞–µ—Ç—Å—è —Å –ø—Ä–æ–±–ª–µ–º–æ–π, –∑–∞–¥–∞–π—Ç–µ **–ø–æ –æ–¥–Ω–æ–º—É –≤–æ–ø—Ä–æ—Å—É –∑–∞ —Ä–∞–∑**, –¥–æ–∂–∏–¥–∞–π—Ç–µ—Å—å –æ—Ç–≤–µ—Ç–∞:

**–ë–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã:**
1. –ß—Ç–æ —É–∂–µ –±—ã–ª–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–æ?
2. –ö–∞–∫ –¥–æ–ª–≥–æ –¥–ª–∏—Ç—Å—è —Å–∏—Ç—É–∞—Ü–∏—è?
3. –ö–∞–∫–æ–≤–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–æ–ø—ã—Ç, —Ä–æ–ª—å, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)?
4. –ö–∞–∫–æ–≤ –∂–µ–ª–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç?

**–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏):**
- –†–∞–∑–º–µ—Ä –≤–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã?
- –í–∞—à –æ–ø—ã—Ç –≤ —Ä–æ–ª–∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è (–Ω–æ–≤—ã–π/–æ–ø—ã—Ç–Ω—ã–π)?
- –ï—Å—Ç—å –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–ø–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏, —Å—Ä–æ–∫–∏, –±—é–¥–∂–µ—Ç)?
- –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞ (—Ñ–æ—Ä–º–∞–ª—å–Ω–∞—è/—Å–≤–æ–±–æ–¥–Ω–∞—è, –∏–µ—Ä–∞—Ä—Ö–∏—á–Ω–∞—è/–ø–ª–æ—Å–∫–∞—è)?

### **–®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:

**1. –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)**
- –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã
- –¢–∏–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ PAEI (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- –£—Ä–æ–≤–µ–Ω—å –∑—Ä–µ–ª–æ—Å—Ç–∏ –ø–æ –•–µ—Ä—Å–∏-–ë–ª–∞–Ω—à–∞—Ä—É (S1/S2/S3/S4)

**2. –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô**

**–®–∞–≥ 1: –ü–µ—Ä–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (—Å–µ–≥–æ–¥–Ω—è-–∑–∞–≤—Ç—Ä–∞)**
- –ß—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ —Å–¥–µ–ª–∞—Ç—å
- –ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏/—Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

**–®–∞–≥ 2: –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ)**
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

**–®–∞–≥ 3: –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**
- –ö–∞–∫ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

**3. –ß–¢–û –°–ö–ê–ó–ê–¢–¨**
–ì–æ—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

**4. –ß–ï–ì–û –ò–ó–ë–ï–ì–ê–¢–¨**
–¢–æ–ø-3 —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –¥–∞–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏

**5. –ü–†–ò–ó–ù–ê–ö–ò –£–°–ü–ï–•–ê**
–ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø–æ–¥—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã)

**6. –ö–†–ê–°–ù–´–ï –§–õ–ê–ì–ò** (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
–ü—Ä–∏–∑–Ω–∞–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è HR/—é—Ä–∏—Å—Ç–∞:
- –£–≥—Ä–æ–∑—ã, –∞–≥—Ä–µ—Å—Å–∏—è, –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
- –î–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è, —Ö–∞—Ä–∞—Å—Å–º–µ–Ω—Ç
- –ü—Ä–∏–∑–Ω–∞–∫–∏ –≤—ã–≥–æ—Ä–∞–Ω–∏—è –∏–ª–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∫—Ä–∏–∑–∏—Å–∞
- –ù–∞—Ä—É—à–µ–Ω–∏—è —ç—Ç–∏–∫–∏/–∫–æ–º–ø–ª–∞–µ–Ω—Å–∞

---

## **–ë–´–°–¢–†–´–ï –®–ê–ë–õ–û–ù–´**

–î–ª—è —Ç–∏–ø–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π –¥–∞–≤–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –º–∏–Ω–∏-—Å–∫—Ä–∏–ø—Ç—ã:

**–°–ª–æ–∂–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:**
"[–ò–º—è], —è —Ö–æ—á—É –æ–±—Å—É–¥–∏—Ç—å [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è]. –Ø –∑–∞–º–µ—Ç–∏–ª [—Ñ–∞–∫—Ç –±–µ–∑ –æ—Ü–µ–Ω–∫–∏]. –≠—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ [–ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è]. –î–∞–≤–∞–π –≤–º–µ—Å—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?"

**–û—Ç–∫–∞–∑ –≤ –ø–æ–≤—ã—à–µ–Ω–∏–∏/–ø—Ä–µ–º–∏–∏:**
"–¶–µ–Ω—é —Ç–≤–æ–π –≤–∫–ª–∞–¥ –≤ [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è]. –°–µ–π—á–∞—Å —Ä–µ—à–µ–Ω–∏–µ –ø–æ –ø–æ–≤—ã—à–µ–Ω–∏—é ‚Äî [–ø—Ä–∏—á–∏–Ω–∞]. –ß—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è –∫ —ç—Ç–æ–π —Ü–µ–ª–∏, –Ω—É–∂–Ω–æ [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏]. –ì–æ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–±—è –≤ —ç—Ç–æ–º."

**–î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:**
"–£ –º–µ–Ω—è –µ—Å—Ç—å –∑–∞–¥–∞—á–∞ [–Ω–∞–∑–≤–∞–Ω–∏–µ]. –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å [–æ–ø–∏—Å–∞–Ω–∏–µ]. –†–µ—Å—É—Ä—Å—ã: [—á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ]. –°—Ä–æ–∫: [–∫–æ–≥–¥–∞]. –ß—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –æ—Ç –º–µ–Ω—è –¥–ª—è —É—Å–ø–µ—Ö–∞?"

**1-on-1 –≤—Å—Ç—Ä–µ—á–∞:**
"–¢—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞: –ö–∞–∫ —É —Ç–µ–±—è –¥–µ–ª–∞? –ß—Ç–æ —Ç–µ–±–µ —Å–µ–π—á–∞—Å –Ω—É–∂–Ω–æ –æ—Ç –º–µ–Ω—è? –ß—Ç–æ —è –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å –ª—É—á—à–µ –∫–∞–∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å?"

---

## **–°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:**

- –û–±—â–∞–π—Ç–µ—Å—å –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞ "–≤—ã"
- –ü–∏—à–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∏ –ø–æ –¥–µ–ª—É ‚Äî –Ω–∏–∫–∞–∫–æ–π –≤–æ–¥—ã
- –î–∞–≤–∞–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã —Ñ—Ä–∞–∑ –∏ –¥–µ–π—Å—Ç–≤–∏–π, –∞ –Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
- –ë—É–¥—å—Ç–µ —ç–º–ø–∞—Ç–∏—á–Ω—ã–º –∫ –æ–±–µ–∏–º —Å—Ç–æ—Ä–æ–Ω–∞–º (—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É)
- –£—á–∏—Ç—ã–≤–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –±–∏–∑–Ω–µ—Å–∞ (—Å—Ä–æ–∫–∏, —Ä–µ—Å—É—Ä—Å—ã, –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–º–ø–∞–Ω–∏–∏)
- –ï—Å–ª–∏ —Å–∏—Ç—É–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ HR –∏–ª–∏ —é—Ä–∏—Å—Ç–∞ ‚Äî —Å–∫–∞–∂–∏—Ç–µ –æ–± —ç—Ç–æ–º –ø—Ä—è–º–æ
- –§–æ–∫—É—Å –Ω–∞ –±—ã—Å—Ç—Ä—ã—Ö —Ç–æ—á–µ—á–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö

---

## **–í–ê–ñ–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´:**

1. **–ö–∞–∂–¥—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–Ω–∏–∫–∞–ª–µ–Ω** ‚Äî –Ω–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π
2. **–°–Ω–∞—á–∞–ª–∞ –ø–æ–Ω—è—Ç—å, –ø–æ—Ç–æ–º –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å** ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
3. **–§–æ–∫—É—Å –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö**, –∞ –Ω–µ –Ω–∞ –ª–∏—á–Ω–æ—Å—Ç–∏
4. **–†–∞–∑–≤–∏—Ç–∏–µ –≤–∞–∂–Ω–µ–µ –Ω–∞–∫–∞–∑–∞–Ω–∏—è** ‚Äî –Ω–æ –µ—Å—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –∂–µ—Å—Ç–∫–∏—Ö –º–µ—Ä
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∂–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤** ‚Äî —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö)
6. **–ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å—Ä–æ—á–Ω–æ—Å—Ç—å—é –±–∏–∑–Ω–µ—Å–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ–º –ª—é–¥–µ–π** ‚Äî –ø–æ–º–æ–≥–∞–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –Ω–∞–π—Ç–∏ —ç—Ç—É –≥—Ä–∞–Ω—å
7. **–ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ —Å—Ç–∏–ª—å –ø–æ–¥ —Å–∏—Ç—É–∞—Ü–∏—é** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –º–æ–¥–µ–ª–∏ PAEI –∏ –•–µ—Ä—Å–∏-–ë–ª–∞–Ω—à–∞—Ä–∞

---

## **–ù–ê–ß–ê–õ–û –†–ê–ë–û–¢–´:**

–ù–∞—á–∏–Ω–∞–π—Ç–µ —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ–ø–∏—à–µ—Ç —Å–≤–æ—é —Å–∏—Ç—É–∞—Ü–∏—é. 

**–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –æ–¥–Ω–æ–º—É –∑–∞ —Ä–∞–∑, –¥–æ–∂–∏–¥–∞–π—Å—è –æ—Ç–≤–µ—Ç–∞, –∑–∞—Ç–µ–º —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å.**"""


class HealthCheckHandler(BaseHTTPRequestHandler):
    """HTTP handler –¥–ª—è health checks –æ–±–ª–∞—á–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º"""
    
    def do_GET(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ GET –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è"""
        self.send_response(200)
        self.send_header('Content-type', 'text/plain')
        self.end_headers()
        self.wfile.write(b'HR Assistant Bot is running')
    
    def log_message(self, format, *args):
        """–û—Ç–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ health check –∑–∞–ø—Ä–æ—Å–æ–≤"""
        pass


def start_health_server():
    """–ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è health checks"""
    port = int(os.getenv('PORT', 8080))
    try:
        server = HTTPServer(('0.0.0.0', port), HealthCheckHandler)
        thread = threading.Thread(target=server.serve_forever, daemon=True)
        thread.start()
        logger.info(f"Health check server started on port {port}")
    except Exception as e:
        logger.warning(f"Could not start health check server: {e}")


class HRAssistantBot:
    """–ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è HR-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º –±–æ—Ç–æ–º"""
    
    def __init__(self, telegram_token: str, anthropic_api_key: str):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
        
        Args:
            telegram_token: –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
            anthropic_api_key: API –∫–ª—é—á Anthropic
        """
        self.telegram_token = telegram_token
        self.anthropic_client = anthropic.Anthropic(api_key=anthropic_api_key)
        
        # –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
        self.conversations: Dict[int, List[Dict]] = {}
        
    def get_conversation_history(self, user_id: int) -> List[Dict]:
        """–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        if user_id not in self.conversations:
            self.conversations[user_id] = []
        return self.conversations[user_id]
    
    def add_message_to_history(self, user_id: int, role: str, content: str):
        """–î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é"""
        if user_id not in self.conversations:
            self.conversations[user_id] = []
        
        self.conversations[user_id].append({
            "role": role,
            "content": content
        })
        
        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ 20 —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (10 –ø–∞—Ä)
        if len(self.conversations[user_id]) > 20:
            self.conversations[user_id] = self.conversations[user_id][-20:]
    
    def clear_conversation(self, user_id: int):
        """–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"""
        self.conversations[user_id] = []
    
    async def get_claude_response(self, user_id: int, user_message: str) -> str:
        """
        –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç Claude
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
            user_message: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            
        Returns:
            –û—Ç–≤–µ—Ç Claude
        """
        try:
            # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∏—Å—Ç–æ—Ä–∏—é
            self.add_message_to_history(user_id, "user", user_message)
            
            # –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
            conversation_history = self.get_conversation_history(user_id)
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ Claude
            response = self.anthropic_client.messages.create(
                model="claude-sonnet-4-20250514",
                max_tokens=4096,
                system=SYSTEM_PROMPT,
                messages=conversation_history
            )
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Ç–≤–µ—Ç
            assistant_message = response.content[0].text
            
            # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é
            self.add_message_to_history(user_id, "assistant", assistant_message)
            
            return assistant_message
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Claude: {e}")
            return "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."
    
    async def start_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
        user = update.effective_user
        user_id = user.id
        
        # –û—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        self.clear_conversation(user_id)
        
        welcome_message = (
            f"üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {user.first_name}!\n\n"
            "–Ø ‚Äî –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º –Ω–∞ –±–∞–∑–µ Claude AI.\n\n"
            "üéØ **–Ø –ø–æ–º–æ–≥—É –≤–∞–º:**\n"
            "‚Ä¢ –ú–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤\n"
            "‚Ä¢ –î–∞–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å\n"
            "‚Ä¢ –†–µ—à–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ –∫–æ–º–∞–Ω–¥–µ\n"
            "‚Ä¢ –£–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é\n"
            "‚Ä¢ –ü—Ä–æ–≤–æ–¥–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã\n"
            "‚Ä¢ –ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!\n\n"
            "üìù **–ü—Ä–æ—Å—Ç–æ –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é**, –∏ —è –∑–∞–¥–∞–º —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, "
            "—á—Ç–æ–±—ã –¥–∞—Ç—å –≤–∞–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.\n\n"
            "üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:\n"
            "/new ‚Äî –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä\n"
            "/help ‚Äî —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é\n\n"
            "–î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º! –ö–∞–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç?"
        )
        
        await update.message.reply_text(welcome_message)
        logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} ({user.username}) –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º")
    
    async def help_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
        help_message = (
            "üìö **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ—Ç–æ–º:**\n\n"
            "1Ô∏è‚É£ –û–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º/–∫–æ–º–∞–Ω–¥–æ–π\n"
            "2Ô∏è‚É£ –Ø –∑–∞–¥–∞–º —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã (–ø–æ –æ–¥–Ω–æ–º—É)\n"
            "3Ô∏è‚É£ –ü–æ—Å–ª–µ —É—Ç–æ—á–Ω–µ–Ω–∏–π –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:\n"
            "   ‚Ä¢ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–∏—Ç—É–∞—Ü–∏–∏\n"
            "   ‚Ä¢ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π\n"
            "   ‚Ä¢ –ì–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤\n"
            "   ‚Ä¢ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö\n\n"
            "üîß **–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\n"
            "/start ‚Äî –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\n"
            "/new ‚Äî –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä (–æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç)\n"
            "/help ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É\n\n"
            "üí° **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**\n"
            "‚Ä¢ \"–ú–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø–µ—Ä–µ—Å—Ç–∞–ª –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ –≤ —Å—Ä–æ–∫\"\n"
            "‚Ä¢ \"–ö–∞–∫ –¥–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ –ø–ª–æ—Ö–æ–π —Ä–∞–±–æ—Ç–µ?\"\n"
            "‚Ä¢ \"–î–≤–∞ —á–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç –º–µ–∂–¥—É —Å–æ–±–æ–π\"\n"
            "‚Ä¢ \"–ù—É–∂–Ω–æ –æ—Ç–∫–∞–∑–∞—Ç—å –≤ –ø–æ–≤—ã—à–µ–Ω–∏–∏\"\n\n"
            "–Ø –∏—Å–ø–æ–ª—å–∑—É—é –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (PAEI –ê–¥–∏–∑–µ—Å–∞, "
            "–°–∏—Ç—É–∞—Ü–∏–æ–Ω–Ω–æ–µ –ª–∏–¥–µ—Ä—Å—Ç–≤–æ –•–µ—Ä—Å–∏-–ë–ª–∞–Ω—à–∞—Ä–∞) –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π."
        )
        
        await update.message.reply_text(help_message)
    
    async def new_conversation_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /new –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"""
        user_id = update.effective_user.id
        self.clear_conversation(user_id)
        
        await update.message.reply_text(
            "‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –æ—á–∏—â–µ–Ω–∞. –ù–∞—á–Ω–µ–º —Å –Ω–∞—á–∞–ª–∞!\n\n"
            "–û–ø–∏—à–∏—Ç–µ –Ω–æ–≤—É—é —Å–∏—Ç—É–∞—Ü–∏—é, —Å –∫–æ—Ç–æ—Ä–æ–π –≤–∞–º –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å."
        )
        logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –Ω–∞—á–∞–ª –Ω–æ–≤—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä")
    
    async def handle_message(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
        user = update.effective_user
        user_id = user.id
        user_message = update.message.text
        
        logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {user_id} ({user.username}): {user_message[:50]}...")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
        await update.message.chat.send_action("typing")
        
        # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç Claude
        response = await self.get_claude_response(user_id, user_message)
        
        # Telegram –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –¥–ª–∏–Ω—É —Å–æ–æ–±—â–µ–Ω–∏—è (4096 —Å–∏–º–≤–æ–ª–æ–≤)
        # –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –¥–ª–∏–Ω–Ω–µ–µ, —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏
        if len(response) <= 4096:
            await update.message.reply_text(response)
        else:
            # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ 4000 —Å–∏–º–≤–æ–ª–æ–≤
            parts = [response[i:i+4000] for i in range(0, len(response), 4000)]
            for part in parts:
                await update.message.reply_text(part)
                await update.message.chat.send_action("typing")
    
    async def error_handler(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫"""
        logger.error(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {context.error}")
        
        if update and update.effective_message:
            await update.effective_message.reply_text(
                "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /new –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞."
            )
    
    def run(self):
        """–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞"""
        # –ó–∞–ø—É—Å–∫–∞–µ–º health check —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±–ª–∞—á–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º (Render, Railway, etc.)
        start_health_server()
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        application = Application.builder().token(self.telegram_token).build()
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
        application.add_handler(CommandHandler("start", self.start_command))
        application.add_handler(CommandHandler("help", self.help_command))
        application.add_handler(CommandHandler("new", self.new_conversation_command))
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, self.handle_message))
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        application.add_error_handler(self.error_handler)
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
        logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
        application.run_polling(allowed_updates=Update.ALL_TYPES)


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    telegram_token = os.getenv("TELEGRAM_BOT_TOKEN")
    anthropic_api_key = os.getenv("ANTHROPIC_API_KEY")
    
    if not telegram_token:
        raise ValueError("–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_BOT_TOKEN")
    
    if not anthropic_api_key:
        raise ValueError("–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è ANTHROPIC_API_KEY")
    
    # –°–æ–∑–¥–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    bot = HRAssistantBot(telegram_token, anthropic_api_key)
    bot.run()


if __name__ == "__main__":
    main()
